# WebSocketSimple-å‚ç…§é»‘é©¬èŠå¤©å®¤
â€‹	è¶…çº§ç®€å•çš„èŠå¤©å®¤å°Demoï¼ŒåŒ…æ‹¬åç«¯ä»£ç å’Œå‰ç«¯ä»£ç ã€‚å‰ç«¯ä»£ç ç”¨AIç”Ÿæˆï¼Œç”¨æˆ·æ•°æ®å†™æ­»ï¼Œå¯èƒ½ä¸å¤Ÿçµæ´»ï¼Œåç«¯ç™»å½•æ¨¡å—ä¹Ÿå†™å¾—æ¯”è¾ƒç®€å•ï¼Œå›ºå®šä¸¤ä¸ªç”¨æˆ·ã€‚

â€‹	æ‹‰å–ä»£ç åç›´æ¥è¿è¡Œå³å¯ï¼Œä¸ç”¨æ·»åŠ ä»»åŠ¡é…ç½®ï¼Œæ¯”å¦‚æ•°æ®åº“é…ç½®ã€Redisé…ç½®ç­‰ã€‚ä¿è¯ä»£ç æœ€ç®€ã€‚

**è´¦å·ï¼šèµµæ• å¯†ç ï¼š123456**

**è´¦å·ï¼šå¼ æ— å¿Œ å¯†ç ï¼š654321**

![image-20250406220404857](https://github.com/user-attachments/assets/4dabf146-5fc1-4662-881b-7f4caa964aab)
![image-20250406220517842](https://github.com/user-attachments/assets/33461b79-0721-4d06-8281-b4a61fa686dc)


# ä¸€ã€ç”¨WebSocketåè®®å®ç°èŠå¤©å®¤çš„åŸå› 

## âœ… ä¸ºä»€ä¹ˆç”¨ WebSocket å®ç°èŠå¤©å®¤ï¼Ÿ

èŠå¤©å®¤çš„æœ¬è´¨éœ€æ±‚æ˜¯ï¼š**å®æ—¶ã€åŒå‘é€šä¿¡ã€å»¶è¿Ÿä½**ã€‚

------

## ğŸ” å…¶ä»–æ–¹æ¡ˆåˆ†æï¼šHTTP è½®è¯¢ å’Œ é•¿è½®è¯¢

### 1. **HTTP è½®è¯¢ï¼ˆPollingï¼‰**

#### âœ… å·¥ä½œæ–¹å¼ï¼š

- å®¢æˆ·ç«¯æ¯éš”å‡ ç§’å‘ä¸€æ¬¡è¯·æ±‚ç»™æœåŠ¡ç«¯ï¼šâ€œæœ‰æ–°æ¶ˆæ¯å—ï¼Ÿâ€
- æœåŠ¡ç«¯ç«‹åˆ»è¿”å›ï¼Œæ— è®ºæœ‰æ²¡æœ‰æ–°æ¶ˆæ¯

#### âš ï¸ ä¼˜ç‚¹ï¼š

- å®ç°ç®€å•ï¼Œå…¼å®¹æ€§æœ€å¥½ï¼ˆæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼‰

#### âŒ ç¼ºç‚¹ï¼š

- **é«˜å»¶è¿Ÿ**ï¼šå¯èƒ½å‡ ç§’åæ‰èƒ½æ‹¿åˆ°æ¶ˆæ¯
- **ä½æ•ˆç‡**ï¼šç»å¤§å¤šæ•°è¯·æ±‚éƒ½æ˜¯æ— æ•ˆçš„ï¼Œæµªè´¹èµ„æº
- **æœåŠ¡å™¨å‹åŠ›å¤§**ï¼šæ¯ä¸ªç”¨æˆ·éƒ½åœ¨é¢‘ç¹è¯·æ±‚

------

### 2. **HTTP é•¿è½®è¯¢ï¼ˆLong Pollingï¼‰**

#### âœ… å·¥ä½œæ–¹å¼ï¼š

- å®¢æˆ·ç«¯å‘è¯·æ±‚åï¼ŒæœåŠ¡ç«¯**ä¸ä¼šç«‹åˆ»å“åº”**ï¼Œè€Œæ˜¯**ç­‰æœ‰æ–°æ¶ˆæ¯æ—¶æ‰è¿”å›**
- å®¢æˆ·ç«¯æ‹¿åˆ°æ¶ˆæ¯åï¼Œå†æ¬¡å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚

#### âš ï¸ ä¼˜ç‚¹ï¼š

- æ¯”æ™®é€šè½®è¯¢å®æ—¶æ€§é«˜å¾ˆå¤š
- ä¸é¢‘ç¹å‘è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å‹åŠ›å°ä¸€ç‚¹

#### âŒ ç¼ºç‚¹ï¼š

- ä»ç„¶æ˜¯**ä¸€æ¬¡æ€§è¿æ¥**ï¼šå‘ -> ç­‰ -> å“åº” -> å†å‘
- æœåŠ¡ç«¯çº¿ç¨‹éœ€è¦ä¿æŒç­‰å¾…ï¼Œ**å¹¶å‘å¤šæ—¶ä¾ç„¶ä¼šå ç”¨å¾ˆå¤šèµ„æº**
- **ä¸æ˜¯çœŸæ­£çš„åŒå‘é€šä¿¡**ï¼Œåªèƒ½æœåŠ¡ç«¯å“åº”ï¼Œå®¢æˆ·ç«¯ä¸èƒ½â€œæ¨é€â€

------

## ğŸŒ WebSocketï¼šèŠå¤©å®¤çš„ç†æƒ³æ–¹æ¡ˆ

### âœ… å·¥ä½œæ–¹å¼ï¼š

- æµè§ˆå™¨å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹ä¸€ä¸ª**æŒä¹…è¿æ¥**ï¼ˆæ¡æ‰‹ä¸€æ¬¡åï¼Œè¿æ¥å¸¸é©»ï¼‰
- **åŒå‘é€šä¿¡**ï¼šæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯éƒ½å¯ä»¥ä¸»åŠ¨å‘æ¶ˆæ¯
- æ¶ˆæ¯æ˜¯é€šè¿‡ TCP çš„ä¸€ç§è½»é‡åè®®ä¼ è¾“ï¼ˆæ¯” HTTP Header å°å¾ˆå¤šï¼‰

------

### âœ… ä¼˜ç‚¹ï¼š

| ä¼˜ç‚¹           | è¯´æ˜                                     |
| -------------- | ---------------------------------------- |
| âš¡ å®æ—¶æ€§å¼º     | æœåŠ¡ç«¯å¯éšæ—¶æ¨é€æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯ï¼Œæ¯«ç§’çº§å»¶è¿Ÿ |
| ğŸ” åŒå‘é€šä¿¡     | å®¢æˆ·ç«¯å‘ï¼ŒæœåŠ¡ç«¯å‘éƒ½å¯ä»¥ï¼Œä¸ç”¨ç­‰è¯·æ±‚     |
| ğŸ“‰ å¼€é”€å°       | æ¡æ‰‹ä¸€æ¬¡å°±ä¸å†é‡å¤å»ºè¿ï¼Œæ— å¤´éƒ¨å†—ä½™       |
| ğŸ“ˆ æ”¯æŒé«˜å¹¶å‘   | ä¸€ä¸ªçº¿ç¨‹å¯æ”¯æŒæ•°åƒä¸ªè¿æ¥ï¼ˆåŸºäºäº‹ä»¶é©±åŠ¨ï¼‰ |
| âœ… æµè§ˆå™¨æ”¯æŒå¥½ | æ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ WebSocket           |

------

### âŒ ç¼ºç‚¹ï¼š

- éœ€è¦æœåŠ¡å™¨å’Œæµè§ˆå™¨æ”¯æŒ WebSocketï¼ˆç°ä»£ç¯å¢ƒåŸºæœ¬æ²¡é—®é¢˜ï¼‰
- å¯¹é˜²ç«å¢™ã€ä»£ç†å¯èƒ½è¦ç‰¹åˆ«é…ç½®ï¼ˆä½†å¸¸è§„éƒ½èƒ½æå®šï¼‰

------

## ğŸ¯ æ€»ç»“ï¼šä¸ºä»€ä¹ˆèŠå¤©å®¤é€‰ WebSocketï¼Ÿ

| æ–¹æ¡ˆ          | å®æ—¶æ€§ | æœåŠ¡ç«¯å‹åŠ› | åŒå‘é€šä¿¡ | æ¨èç¨‹åº¦ |
| ------------- | ------ | ---------- | -------- | -------- |
| HTTP è½®è¯¢     | âŒ å·®   | âŒ å¤§       | âŒ æ—      | âŒ        |
| é•¿è½®è¯¢        | â­• ä¸€èˆ¬ | â­• è¾ƒé«˜     | âŒ æ—      | â­•        |
| **WebSocket** | âœ… æå¥½ | âœ… å°       | âœ… æœ‰     | âœ…âœ…âœ…      |

> æ‰€ä»¥ä½ ä¼šå‘ç°ï¼š**å³æ—¶é€šè®¯ã€èŠå¤©å®¤ã€ååŒç¼–è¾‘ã€åœ¨çº¿å®¢æœã€æ¸¸æˆå¯¹æˆ˜**è¿™ç±»å®æ—¶åœºæ™¯ï¼ŒåŸºæœ¬éƒ½é‡‡ç”¨ WebSocketã€‚

## ğŸ”¥ ä»€ä¹ˆæ˜¯ SSEï¼ˆServer-Sent Eventsï¼‰ï¼Ÿ

SSE æ˜¯ HTML5 æä¾›çš„ä¸€ç§æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯çš„æŠ€æœ¯ã€‚

- åŸºäº HTTP åè®®ï¼Œå•å‘é€šé“ï¼ˆServer â¡ Clientï¼‰
- å®¢æˆ·ç«¯ç”¨ `EventSource` å¯¹è±¡æ¥æ”¶æ¶ˆæ¯
- è¿æ¥æ˜¯**æŒä¹…çš„**ï¼ŒæœåŠ¡ç«¯é€šè¿‡æµå¼æ–¹å¼æŒç»­å‘é€æ•°æ®

------

## âœ… SSE çš„ç‰¹ç‚¹

| ç‰¹æ€§                 | è¯´æ˜                                                       |
| -------------------- | ---------------------------------------------------------- |
| ğŸ“¡ å•å‘é€šä¿¡           | åªèƒ½æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€ï¼Œå®¢æˆ·ç«¯ä¸èƒ½ä¸»åŠ¨å‘æ¶ˆæ¯               |
| ğŸ§± åŸºäº HTTP          | ä½¿ç”¨æ™®é€š HTTPï¼Œä¸éœ€è¦é¢å¤–åè®®æˆ–æ¡æ‰‹ï¼ˆæ¯” WebSocket æ›´å…¼å®¹ï¼‰ |
| â³ è‡ªåŠ¨é‡è¿           | SSE åŸç”Ÿæ”¯æŒæ–­çº¿é‡è¿ï¼ˆæµè§ˆå™¨å¸®ä½ é‡è¯•ï¼‰                     |
| ğŸ§¼ æ–‡æœ¬æµä¼ è¾“         | åªèƒ½ä¼ è¾“ UTF-8 ç¼–ç çš„æ–‡æœ¬æ•°æ®ï¼Œä¸æ”¯æŒäºŒè¿›åˆ¶                |
| ğŸ“¦ å†…ç½®å¿ƒè·³æœºåˆ¶       | SSE æ”¯æŒ `:heartbeat` æ¥ä¿æŒè¿æ¥æ´»æ€§                       |
| âœ… å…¼å®¹æµè§ˆå™¨äº‹ä»¶æ¨¡å‹ | å¯ä»¥ç›‘å¬ä¸åŒç±»å‹çš„äº‹ä»¶ï¼ˆ`message`, `open`, `error`ï¼‰       |

------

## âŒ SSE çš„é™åˆ¶

| é™åˆ¶             | è¯´æ˜                                                         |
| ---------------- | ------------------------------------------------------------ |
| âŒ åªèƒ½æœåŠ¡ç«¯æ¨é€ | å®¢æˆ·ç«¯ä¸èƒ½ä¸»åŠ¨å‘æ¶ˆæ¯ï¼ˆä¸åƒ WebSocket æ˜¯åŒå‘çš„ï¼‰              |
| âŒ ä¸æ”¯æŒ IE      | IE å’Œä¸€äº›è€æµè§ˆå™¨ä¸æ”¯æŒ `EventSource`                        |
| âŒ ä¸æ”¯æŒäºŒè¿›åˆ¶   | ä¸é€‚åˆä¼ è¾“æ–‡ä»¶ã€å›¾ç‰‡ã€éŸ³é¢‘ç­‰                                 |
| âŒ å¹¶å‘è¿æ¥é™åˆ¶   | æµè§ˆå™¨å¯¹æ¯ä¸ªåŸŸåçš„ EventSource è¿æ¥æ•°é‡æœ‰é™åˆ¶ï¼ˆChrome é»˜è®¤æ˜¯ 6 ä¸ªï¼‰ |

------

## âœ… SSE vs WebSocket vs HTTPè½®è¯¢å¯¹æ¯”æ€»ç»“

| ç‰¹æ€§       | HTTPè½®è¯¢        | é•¿è½®è¯¢          | SSE                  | WebSocket                |
| ---------- | --------------- | --------------- | -------------------- | ------------------------ |
| å®æ—¶æ€§     | âŒ å·®            | â­• ä¸€èˆ¬          | âœ… å¥½                 | âœ… æå¥½                   |
| é€šä¿¡æ–¹å‘   | å®¢æˆ·ç«¯ â¡ æœåŠ¡ç«¯ | å®¢æˆ·ç«¯ â¡ æœåŠ¡ç«¯ | **æœåŠ¡ç«¯ â¡ å®¢æˆ·ç«¯**  | **åŒå‘é€šä¿¡**             |
| å¼€é”€       | âŒ å¤§            | â­• ä¸­            | âœ… å°                 | âœ… æœ€å°                   |
| æ”¯æŒäºŒè¿›åˆ¶ | âŒ å¦            | âŒ å¦            | âŒ å¦                 | âœ… æ˜¯                     |
| æµè§ˆå™¨æ”¯æŒ | âœ… å…¨éƒ¨          | âœ… å…¨éƒ¨          | â­• ç°ä»£æµè§ˆå™¨         | âœ… ç°ä»£æµè§ˆå™¨             |
| ç¼–ç¨‹å¤æ‚åº¦ | âœ… ç®€å•          | â­• ä¸­            | âœ… ç®€å•               | â­• ç¨å¤æ‚                 |
| æ–­çº¿é‡è¿   | âŒ æ—             | âŒ æ—             | âœ… æœ‰                 | âŒ éœ€è¦æ‰‹åŠ¨å®ç°           |
| åœºæ™¯       | æ™®é€šæŸ¥è¯¢        | å®æ—¶ç›‘æ§        | æ–°é—»æ¨é€ã€è‚¡ç¥¨ã€æ—¥å¿— | èŠå¤©å®¤ã€åä½œã€æ¸¸æˆã€å®¢æœ |

------

## ğŸ§  èŠå¤©å®¤é€‰ WebSocket çš„ç†ç”±ï¼ˆSSE ä¸å¤ªé€‚åˆï¼‰ï¼š

- èŠå¤©éœ€è¦**åŒå‘é€šä¿¡**ï¼ˆç”¨æˆ·å‘æ¶ˆæ¯ã€æœåŠ¡å™¨å¹¿æ’­ï¼‰ â¡ SSE ä¸æ”¯æŒ
- WebSocket æ”¯æŒ**ä»»æ„ç±»å‹æ•°æ®**ï¼ˆæ–‡æœ¬ã€JSONã€äºŒè¿›åˆ¶ï¼‰ â¡ SSE åªèƒ½ UTF-8 æ–‡æœ¬
- èŠå¤©æ¶‰åŠ**å¤šäººäº¤äº’å’Œé«˜å¹¶å‘**ï¼ŒWebSocket æ›´é«˜æ•ˆ
- SSE é€‚åˆ**ä¸€å¯¹å¤šã€æœåŠ¡ç«¯æ¨é€åœºæ™¯**ï¼Œæ¯”å¦‚ï¼šæ–°é—»è®¢é˜…ã€ç›‘æ§æ—¥å¿—æµ

# äºŒã€åç«¯ä»£ç é…ç½®

### âœ… ä¸€ã€å¼•å…¥ä¾èµ–ï¼ˆMavenï¼‰

```
xmlå¤åˆ¶ç¼–è¾‘<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-websocket</artifactId>
</dependency>
```

------

### âœ… äºŒã€é…ç½®ç±»ï¼š`ServerEndpointExporter`

Spring Boot ä¸­éœ€è¦æ˜¾å¼æ³¨å†Œ WebSocket ç«¯ç‚¹ï¼š

```
javaå¤åˆ¶ç¼–è¾‘import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.socket.server.standard.ServerEndpointExporter;

@Configuration
public class WebSocketConfig {
    @Bean
    public ServerEndpointExporter serverEndpointExporter() {
        return new ServerEndpointExporter();
    }
}
```

> æ³¨æ„ï¼š`ServerEndpointExporter` åªæœ‰åœ¨ä½ ä½¿ç”¨çš„æ˜¯ Spring Boot çš„å†…åµŒå®¹å™¨ï¼ˆæ¯”å¦‚ Tomcatï¼‰æ—¶æ‰éœ€è¦æ‰‹åŠ¨é…ç½®ã€‚

------

### âœ… ä¸‰ã€è·å– `HttpSession` çš„é…ç½®ç±»

å› ä¸º `@ServerEndpoint` çš„ç±»ä¸å— Spring ç®¡ç†ï¼Œè¦æƒ³è·å– `HttpSession`ï¼Œéœ€è¦é€šè¿‡ `Configurator` å®ç°ï¼š

```
javaå¤åˆ¶ç¼–è¾‘import javax.servlet.http.HttpSession;
import javax.websocket.HandshakeResponse;
import javax.websocket.server.HandshakeRequest;
import javax.websocket.server.ServerEndpointConfig;

public class GetHttpSessionConfigurator extends ServerEndpointConfig.Configurator {
    @Override
    public void modifyHandshake(ServerEndpointConfig config,
                                HandshakeRequest request,
                                HandshakeResponse response) {
        HttpSession httpSession = (HttpSession) request.getHttpSession();
        config.getUserProperties().put(HttpSession.class.getName(), httpSession);
    }
}
```

------

### âœ… å››ã€WebSocket æœåŠ¡ç«¯å®ç°ç±»

```
javaå¤åˆ¶ç¼–è¾‘import javax.websocket.*;
import javax.websocket.server.ServerEndpoint;
import java.util.concurrent.ConcurrentHashMap;
import java.util.Map;

@ServerEndpoint(value = "/chat", configurator = GetHttpSessionConfigurator.class)
@Component
public class ChatEndpoint {
    private static final Map<String, Session> onlineSessions = new ConcurrentHashMap<>();

    @OnOpen
    public void onOpen(Session session, EndpointConfig config) {
        // è·å– HttpSession ä¸­çš„ç”¨æˆ·ä¿¡æ¯ç­‰
    }

    @OnMessage
    public void onMessage(String message, Session session) {
        // æ¶ˆæ¯å¤„ç†é€»è¾‘
    }

    @OnClose
    public void onClose(Session session) {
        // ç”¨æˆ·ä¸‹çº¿é€»è¾‘
    }
}
```

------

### âœ… äº”ã€å‰ç«¯è¿æ¥ç¤ºä¾‹

è™½ç„¶ä½ çš„ PDF æ²¡å®Œæ•´åˆ—å‡ºå‰ç«¯å†…å®¹ï¼Œä½†å‰ç«¯ä¸€èˆ¬é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿æ¥ï¼š

```
javascriptå¤åˆ¶ç¼–è¾‘const socket = new WebSocket("ws://localhost:8080/chat");

socket.onopen = () => {
    console.log("Connected");
};

socket.onmessage = (event) => {
    console.log("Message from server:", event.data);
};

socket.onclose = () => {
    console.log("Disconnected");
};
```

# ä¸‰ã€åç«¯è®¾è®¡æ—¶åºå›¾
![image-20250406222320605](https://github.com/user-attachments/assets/0093ba11-bdec-4283-8410-d9912549e166)



# å››ã€å‰ç«¯ä»£ç ï¼ˆAIç”Ÿæˆï¼Œå¯ä»¥è‡ªå·±ä¼˜åŒ–ï¼‰

